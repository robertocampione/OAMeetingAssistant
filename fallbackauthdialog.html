<!DOCTYPE html>
<html>
  <head>
    <title>Fallback SSO</title>
    <script>
      window.onload = function () {
        const hash = window.location.hash.substring(1);
        const params = new URLSearchParams(hash);
        const accessToken = params.get("access_token");

        if (accessToken) {
          // Send token back to parent window
          window.opener.postMessage(
            {
              message: "token",
              accessToken: accessToken
            },
            "*"
          );
          const accessToken = event.data.accessToken;
          const expiry = now + 60 * 60 * 1000;

          sessionStorage.setItem("sso_token_data", JSON.stringify({
          token: accessToken,
          expiry
          }));
          
          window.close();
        } else {
          document.body.innerText = "Login failed or canceled.";
        }
      };
    </script>
  </head>
  <body>
    Authenticating...
  </body>
</html>
